pipeline:
  # 1. build the new docker image from Dockerfile 
  # 2. push to Nexus with tag "test", need to update kube-deploy-test.yml to match it
  push_to_nexus:
    image: plugins/docker
    repo: 'nexus.teamdigitale.test/ml-api'
    registry: nexus.teamdigitale.test
    tags: "test"
    secrets: [ docker_username, docker_password ]
    dockerfile: outbox-classification/web-api/Dockerfile 
    insecure: true

    
  # deploy the built image to Kubernetes
  # deploy_to_kube:
  #   image: vallard/drone-kube
  #   template: kube-deploy-test.yml
  #   namespace: default
  #   # server: ?
